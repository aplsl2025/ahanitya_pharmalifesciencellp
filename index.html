<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Ahanitya Inventory Web App</title>
  <style>
    :root{
      --brand:#11799a;
      --brand2:#0f5f79;
      --bg:#f5f7fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --danger:#dc2626;
      --ok:#16a34a;
      --shadow: 0 10px 25px rgba(2, 6, 23, .08);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:linear-gradient(180deg, #eaf5f8 0%, var(--bg) 55%);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10;
      background:rgba(255,255,255,.7);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(15,23,42,.08);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:16px}
    .topbar{
      display:flex; align-items:center; gap:12px; justify-content:space-between;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800; letter-spacing:.2px;
    }
    .logo{
      width:38px; height:38px; border-radius:12px;
      background: radial-gradient(circle at 30% 30%, #41c7df, var(--brand));
      box-shadow: var(--shadow);
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:999px;
      border:1px solid rgba(15,23,42,.10);
      background:#fff;
      color:var(--muted);
      font-size:13px;
    }
    .grid{
      display:grid; grid-template-columns: 1.2fr .8fr; gap:16px;
      margin-top:16px;
    }
    @media (max-width: 920px){
      .grid{grid-template-columns:1fr}
    }
    .card{
      background:var(--card); border-radius:var(--radius);
      box-shadow: var(--shadow);
      border:1px solid rgba(15,23,42,.07);
      overflow:hidden;
    }
    .card h2{
      margin:0; padding:16px 16px 0; font-size:18px;
    }
    .card p.sub{margin:6px 16px 16px; color:var(--muted); font-size:13px}
    .content{padding:16px}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:520px){ .row{grid-template-columns:1fr} }
    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px}
    input, select{
      width:100%;
      padding:11px 12px;
      border-radius:12px;
      border:1px solid rgba(15,23,42,.14);
      outline:none;
      font-size:14px;
      background:#fff;
    }
    input:focus, select:focus{border-color: rgba(17,121,154,.55); box-shadow: 0 0 0 4px rgba(17,121,154,.12)}
    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    button{
      border:none; cursor:pointer;
      padding:11px 14px; border-radius:12px;
      font-weight:700; font-size:14px;
    }
    .btn-primary{background:var(--brand); color:#fff}
    .btn-primary:hover{background:var(--brand2)}
    .btn-ghost{
      background:#fff; color:var(--text);
      border:1px solid rgba(15,23,42,.14);
    }
    .btn-danger{background:var(--danger); color:#fff}
    .btn-ok{background:var(--ok); color:#fff}
    .note{
      font-size:12px; color:var(--muted);
      margin-top:10px; line-height:1.35;
    }

    .hidden{display:none !important}
    .tabs{display:flex; gap:8px; padding:10px; border-bottom:1px solid rgba(15,23,42,.08); background:#fff}
    .tab{
      padding:9px 12px; border-radius:999px;
      border:1px solid rgba(15,23,42,.12);
      background:#fff; color:var(--muted);
      font-weight:800; font-size:13px;
    }
    .tab.active{
      border-color: rgba(17,121,154,.4);
      background: rgba(17,121,154,.10);
      color: var(--brand2);
    }

    .tablewrap{overflow:auto; border-radius:14px; border:1px solid rgba(15,23,42,.10)}
    table{width:100%; border-collapse:collapse; min-width:760px; background:#fff}
    th, td{padding:10px 10px; border-bottom:1px solid rgba(15,23,42,.06); text-align:left; font-size:13px}
    th{font-size:12px; color:var(--muted); background:rgba(2,6,23,.02)}
    .chip{
      display:inline-flex; align-items:center;
      padding:5px 9px; border-radius:999px;
      font-weight:800; font-size:12px;
      border:1px solid rgba(15,23,42,.10);
      background:#fff;
    }
    .chip.low{border-color: rgba(220,38,38,.35); background: rgba(220,38,38,.08); color: var(--danger)}
    .chip.ok{border-color: rgba(22,163,74,.35); background: rgba(22,163,74,.08); color: var(--ok)}
    .right{display:flex; justify-content:flex-end; gap:8px}
    .small{padding:8px 10px; border-radius:10px; font-size:12px; font-weight:800}
    .muted{color:var(--muted)}
    .kpi{
      display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin-top:10px;
    }
    @media (max-width:520px){ .kpi{grid-template-columns:1fr} }
    .kpi .box{
      padding:12px; border-radius:14px;
      border:1px solid rgba(15,23,42,.08);
      background:rgba(255,255,255,.75);
    }
    .kpi .n{font-size:18px; font-weight:900}
    .kpi .t{font-size:12px; color:var(--muted); margin-top:2px}
    footer{padding:24px 16px; color:var(--muted); font-size:12px; text-align:center}
    .alert{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(15,23,42,.12);
      background:#fff;
      font-size:13px;
    }
    .alert.ok{border-color: rgba(22,163,74,.35); background: rgba(22,163,74,.08); color: var(--ok)}
    .alert.bad{border-color: rgba(220,38,38,.35); background: rgba(220,38,38,.08); color: var(--danger)}
  </style>
</head>
<body>
<header>
  <div class="wrap topbar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        Ahanitya Inventory Web App
        <div class="muted" style="font-weight:700; font-size:12px">User Login + Admin Inventory Update</div>
      </div>
    </div>
    <div class="pill" id="sessionPill">Not logged in</div>
  </div>
</header>

<main class="wrap">
  <div class="grid">
    <!-- LEFT: APP -->
    <div class="card">
      <div class="tabs">
        <button class="tab active" id="tabUser">User Login</button>
        <button class="tab" id="tabAdmin">Admin Login</button>
        <button class="tab hidden" id="tabInventory">Inventory</button>
      </div>

      <!-- USER LOGIN -->
      <section id="panelUser" class="content">
        <h2>User Login</h2>
        <p class="sub">Login using Email, Name, and Phone number.</p>

        <div class="row">
          <div>
            <label>Email</label>
            <input id="uEmail" type="email" placeholder="name@example.com" />
          </div>
          <div>
            <label>Name</label>
            <input id="uName" type="text" placeholder="Full name" />
          </div>
        </div>

        <div style="margin-top:12px">
          <label>Phone</label>
          <input id="uPhone" type="tel" placeholder="10-digit mobile number" />
        </div>

        <div class="btns">
          <button class="btn-primary" id="btnUserLogin">Login</button>
          <button class="btn-ghost" id="btnUserLogout">Logout</button>
          <button class="btn-ghost" id="btnGoInventoryFromUser">View Inventory</button>
        </div>

        <div class="note">
          Inventory data is stored in your browser (localStorage). If you open this on another phone/device, the data will not sync automatically.
        </div>
        <div id="userAlert" class="alert hidden"></div>
      </section>

      <!-- ADMIN LOGIN -->
      <section id="panelAdmin" class="content hidden">
        <h2>Admin Login</h2>
        <p class="sub">Admin can update Stock, Price, and MRP.</p>

        <div class="row">
          <div>
            <label>Admin ID (Email)</label>
            <input id="aEmail" type="email" placeholder="admin@example.com" />
          </div>
          <div>
            <label>Password</label>
            <input id="aPass" type="password" placeholder="••••••••" />
          </div>
        </div>

        <div class="btns">
          <button class="btn-primary" id="btnAdminLogin">Login as Admin</button>
          <button class="btn-ghost" id="btnAdminLogout">Logout</button>
          <button class="btn-ghost" id="btnGoInventoryFromAdmin">Open Inventory Panel</button>
        </div>

        <div class="note">
          Default Admin credentials are inside this HTML file (you can change them in the code).
        </div>
        <div id="adminAlert" class="alert hidden"></div>
      </section>

      <!-- INVENTORY -->
      <section id="panelInventory" class="content hidden">
        <h2>Inventory</h2>
        <p class="sub">Search and view medicines. Admin can add/edit/delete.</p>

        <div class="row">
          <div>
            <label>Search</label>
            <input id="searchBox" type="text" placeholder="Search by medicine name..." />
          </div>
          <div>
            <label>Filter</label>
            <select id="stockFilter">
              <option value="all">All</option>
              <option value="in">In stock</option>
              <option value="low">Low stock (≤ 10)</option>
              <option value="out">Out of stock</option>
            </select>
          </div>
        </div>

        <div class="kpi">
          <div class="box">
            <div class="n" id="kpiTotal">0</div>
            <div class="t">Total Items</div>
          </div>
          <div class="box">
            <div class="n" id="kpiInStock">0</div>
            <div class="t">In Stock</div>
          </div>
          <div class="box">
            <div class="n" id="kpiLow">0</div>
            <div class="t">Low / Out</div>
          </div>
        </div>

        <div class="btns" style="margin-top:14px">
          <button class="btn-primary hidden" id="btnAddNew">+ Add Medicine</button>
          <button class="btn-ghost" id="btnExport">Export JSON</button>
          <button class="btn-ghost" id="btnImport">Import JSON</button>
          <button class="btn-danger hidden" id="btnReset">Reset Demo Data</button>
        </div>

        <div class="tablewrap" style="margin-top:12px">
          <table>
            <thead>
              <tr>
                <th>Medicine</th>
                <th>Strength / Pack</th>
                <th>MRP (₹)</th>
                <th>Price (₹)</th>
                <th>Stock</th>
                <th>Status</th>
                <th style="width:210px">Actions</th>
              </tr>
            </thead>
            <tbody id="invBody"></tbody>
          </table>
        </div>

        <div id="invAlert" class="alert hidden"></div>
      </section>
    </div>

    <!-- RIGHT: ADD/EDIT FORM -->
    <div class="card">
      <div class="content">
        <h2 id="formTitle">Medicine Details</h2>
        <p class="sub" id="formSub">Admins can add/edit medicines here.</p>

        <div id="formLockNote" class="alert bad">
          Admin login required to edit inventory.
        </div>

        <div id="medicineForm" class="hidden">
          <input type="hidden" id="mId" />

          <div style="margin-bottom:12px">
            <label>Medicine Name</label>
            <input id="mName" type="text" placeholder="e.g., Montelukast + Levocetirizine" />
          </div>

          <div class="row">
            <div>
              <label>Strength / Pack</label>
              <input id="mPack" type="text" placeholder="e.g., 10 Tablets / 10 Caps" />
            </div>
            <div>
              <label>Stock Qty</label>
              <input id="mStock" type="number" min="0" placeholder="e.g., 50" />
            </div>
          </div>

          <div class="row" style="margin-top:12px">
            <div>
              <label>MRP (₹)</label>
              <input id="mMrp" type="number" min="0" step="0.01" placeholder="e.g., 170" />
            </div>
            <div>
              <label>Price (₹)</label>
              <input id="mPrice" type="number" min="0" step="0.01" placeholder="e.g., 135" />
            </div>
          </div>

          <div class="btns">
            <button class="btn-ok" id="btnSave">Save</button>
            <button class="btn-ghost" id="btnClear">Clear</button>
          </div>

          <div class="note">
            Tip: Keep <b>Price</b> lower than <b>MRP</b> for trade margin.
          </div>
          <div id="formAlert" class="alert hidden"></div>
        </div>

      </div>
    </div>
  </div>
</main>

<footer>
  © <span id="yr"></span> Ahanitya Pharma Life Science LLP — Inventory Web App (Static demo)
</footer>

<script>
/* =========================
   CONFIG (CHANGE AS NEEDED)
   ========================= */
const CONFIG = {
  appStorageKey: "ahanitya_inventory_v1",
  sessionKey: "ahanitya_session_v1",
  // Change these admin credentials:
  adminEmail: "infoahanityapharmalifescellp@gmail.com",
  adminPassword: "Ahanitya@123",
  lowStockThreshold: 10
};

/* =========================
   UTILITIES
   ========================= */
const $ = (id) => document.getElementById(id);

function showAlert(el, msg, kind="ok"){
  el.classList.remove("hidden","ok","bad");
  el.classList.add(kind === "bad" ? "bad" : "ok");
  el.textContent = msg;
  setTimeout(()=> el.classList.add("hidden"), 3500);
}

function currency(n){
  const x = Number(n || 0);
  return x.toFixed(2);
}

function uid(){
  return "m_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16);
}

/* =========================
   DATA: LOAD/SAVE INVENTORY
   ========================= */
function demoData(){
  return [
    { id: uid(), name:"Montelukast + Levocetirizine", pack:"10 Tablets", mrp:170, price:135, stock:45 },
    { id: uid(), name:"Pantoprazole", pack:"10 Tablets", mrp:120, price:92, stock:18 },
    { id: uid(), name:"Vitamin D3 60000 IU", pack:"4 Caps", mrp:110, price:78, stock:8 },
    { id: uid(), name:"Azithromycin 500", pack:"3 Tablets", mrp:95, price:70, stock:0 }
  ];
}

function loadInventory(){
  const raw = localStorage.getItem(CONFIG.appStorageKey);
  if(!raw){
    const seed = demoData();
    localStorage.setItem(CONFIG.appStorageKey, JSON.stringify(seed));
    return seed;
  }
  try{
    const data = JSON.parse(raw);
    if(!Array.isArray(data)) throw new Error("Invalid");
    return data;
  }catch(e){
    const seed = demoData();
    localStorage.setItem(CONFIG.appStorageKey, JSON.stringify(seed));
    return seed;
  }
}

function saveInventory(data){
  localStorage.setItem(CONFIG.appStorageKey, JSON.stringify(data));
}

let inventory = loadInventory();

/* =========================
   SESSION
   ========================= */
function getSession(){
  const raw = localStorage.getItem(CONFIG.sessionKey);
  if(!raw) return null;
  try{ return JSON.parse(raw); }catch{ return null; }
}
function setSession(sess){
  localStorage.setItem(CONFIG.sessionKey, JSON.stringify(sess));
  updateSessionPill();
  syncRoleUI();
}
function clearSession(){
  localStorage.removeItem(CONFIG.sessionKey);
  updateSessionPill();
  syncRoleUI();
}
function isAdmin(){
  const s = getSession();
  return s && s.role === "admin";
}
function isUser(){
  const s = getSession();
  return s && s.role === "user";
}

function updateSessionPill(){
  const s = getSession();
  if(!s){
    $("sessionPill").textContent = "Not logged in";
    return;
  }
  if(s.role === "admin"){
    $("sessionPill").textContent = "Admin: " + s.email;
  }else{
    $("sessionPill").textContent = "User: " + s.name + " (" + s.phone + ")";
  }
}

/* =========================
   TABS / PANELS
   ========================= */
function setActiveTab(tab){
  ["tabUser","tabAdmin","tabInventory"].forEach(id => $(id).classList.remove("active"));
  tab.classList.add("active");
}

function showPanel(which){
  $("panelUser").classList.add("hidden");
  $("panelAdmin").classList.add("hidden");
  $("panelInventory").classList.add("hidden");

  if(which === "user") $("panelUser").classList.remove("hidden");
  if(which === "admin") $("panelAdmin").classList.remove("hidden");
  if(which === "inventory") $("panelInventory").classList.remove("hidden");
}

function syncRoleUI(){
  // Inventory tab visibility
  $("tabInventory").classList.toggle("hidden", !(isUser() || isAdmin()));

  // Admin-only buttons
  $("btnAddNew").classList.toggle("hidden", !isAdmin());
  $("btnReset").classList.toggle("hidden", !isAdmin());

  // Right-side form lock
  $("formLockNote").classList.toggle("hidden", isAdmin());
  $("medicineForm").classList.toggle("hidden", !isAdmin());

  // Default view behavior
  if(!(isUser() || isAdmin())){
    setActiveTab($("tabUser"));
    showPanel("user");
  }

  renderInventory();
}

/* =========================
   INVENTORY RENDER + KPIs
   ========================= */
function statusChip(stock){
  const s = Number(stock || 0);
  if(s <= 0) return `<span class="chip low">Out</span>`;
  if(s <= CONFIG.lowStockThreshold) return `<span class="chip low">Low</span>`;
  return `<span class="chip ok">In</span>`;
}

function matchesFilter(item){
  const q = ($("searchBox").value || "").trim().toLowerCase();
  const f = $("stockFilter").value;

  const nameOk = item.name.toLowerCase().includes(q) || item.pack.toLowerCase().includes(q);

  let stockOk = true;
  const s = Number(item.stock || 0);
  if(f === "in") stockOk = s > CONFIG.lowStockThreshold;
  if(f === "low") stockOk = s > 0 && s <= CONFIG.lowStockThreshold;
  if(f === "out") stockOk = s <= 0;

  return nameOk && stockOk;
}

function renderKPIs(list){
  const total = list.length;
  const inStock = list.filter(x => Number(x.stock||0) > CONFIG.lowStockThreshold).length;
  const lowOut = total - inStock;

  $("kpiTotal").textContent = total;
  $("kpiInStock").textContent = inStock;
  $("kpiLow").textContent = lowOut;
}

function renderInventory(){
  const list = inventory.filter(matchesFilter);

  renderKPIs(inventory);

  const tbody = $("invBody");
  tbody.innerHTML = "";

  if(list.length === 0){
    tbody.innerHTML = `<tr><td colspan="7" class="muted">No items found.</td></tr>`;
    return;
  }

  for(const item of list){
    const canEdit = isAdmin();
    const actions = canEdit
      ? `
        <div class="right">
          <button class="small btn-ghost" onclick="editItem('${item.id}')">Edit</button>
          <button class="small btn-danger" onclick="deleteItem('${item.id}')">Delete</button>
        </div>`
      : `<span class="muted">View only</span>`;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><b>${escapeHtml(item.name)}</b></td>
      <td>${escapeHtml(item.pack)}</td>
      <td>₹ ${currency(item.mrp)}</td>
      <td>₹ ${currency(item.price)}</td>
      <td><b>${Number(item.stock||0)}</b></td>
      <td>${statusChip(item.stock)}</td>
      <td>${actions}</td>
    `;
    tbody.appendChild(tr);
  }
}

// Basic HTML escape for safe rendering
function escapeHtml(str){
  return String(str ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* =========================
   ADMIN CRUD
   ========================= */
function clearForm(){
  $("mId").value = "";
  $("mName").value = "";
  $("mPack").value = "";
  $("mMrp").value = "";
  $("mPrice").value = "";
  $("mStock").value = "";
  $("formTitle").textContent = "Medicine Details";
  $("formSub").textContent = "Admins can add/edit medicines here.";
}

window.editItem = function(id){
  if(!isAdmin()) return;
  const item = inventory.find(x => x.id === id);
  if(!item) return;

  $("mId").value = item.id;
  $("mName").value = item.name;
  $("mPack").value = item.pack;
  $("mMrp").value = item.mrp;
  $("mPrice").value = item.price;
  $("mStock").value = item.stock;

  $("formTitle").textContent = "Edit Medicine";
  $("formSub").textContent = "Update stock, price, and MRP then Save.";
}

window.deleteItem = function(id){
  if(!isAdmin()) return;
  const item = inventory.find(x => x.id === id);
  if(!item) return;

  const ok = confirm("Delete this medicine?\n\n" + item.name);
  if(!ok) return;

  inventory = inventory.filter(x => x.id !== id);
  saveInventory(inventory);
  renderInventory();
  clearForm();
  showAlert($("invAlert"), "Deleted successfully.", "ok");
}

function addNew(){
  if(!isAdmin()) return;
  clearForm();
  $("formTitle").textContent = "Add New Medicine";
  $("formSub").textContent = "Fill details and click Save.";
}

/* =========================
   IMPORT / EXPORT
   ========================= */
function exportJSON(){
  const blob = new Blob([JSON.stringify(inventory, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "inventory.json";
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
  showAlert($("invAlert"), "Exported inventory.json", "ok");
}

function importJSON(){
  const inp = document.createElement("input");
  inp.type = "file";
  inp.accept = ".json,application/json";
  inp.onchange = () => {
    const file = inp.files && inp.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = () => {
      try{
        const data = JSON.parse(reader.result);
        if(!Array.isArray(data)) throw new Error("Invalid JSON");

        // Normalize and ensure IDs
        inventory = data.map(x => ({
          id: x.id || uid(),
          name: String(x.name || ""),
          pack: String(x.pack || ""),
          mrp: Number(x.mrp || 0),
          price: Number(x.price || 0),
          stock: Number(x.stock || 0),
        }));

        saveInventory(inventory);
        renderInventory();
        showAlert($("invAlert"), "Imported successfully.", "ok");
      }catch(e){
        showAlert($("invAlert"), "Import failed: invalid JSON format.", "bad");
      }
    };
    reader.readAsText(file);
  };
  inp.click();
}

/* =========================
   EVENTS
   ========================= */
$("tabUser").addEventListener("click", () => {
  setActiveTab($("tabUser"));
  showPanel("user");
});
$("tabAdmin").addEventListener("click", () => {
  setActiveTab($("tabAdmin"));
  showPanel("admin");
});
$("tabInventory").addEventListener("click", () => {
  setActiveTab($("tabInventory"));
  showPanel("inventory");
  renderInventory();
});

$("btnUserLogin").addEventListener("click", () => {
  const email = ($("uEmail").value || "").trim();
  const name = ($("uName").value || "").trim();
  const phone = ($("uPhone").value || "").trim();

  const phoneOk = /^[0-9]{10}$/.test(phone);
  const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);

  if(!emailOk) return showAlert($("userAlert"), "Enter a valid email.", "bad");
  if(name.length < 2) return showAlert($("userAlert"), "Enter your name.", "bad");
  if(!phoneOk) return showAlert($("userAlert"), "Enter valid 10-digit phone.", "bad");

  setSession({ role:"user", email, name, phone, ts: Date.now() });
  showAlert($("userAlert"), "User login successful.", "ok");
});

$("btnUserLogout").addEventListener("click", () => {
  clearSession();
  showAlert($("userAlert"), "Logged out.", "ok");
});

$("btnGoInventoryFromUser").addEventListener("click", () => {
  if(!(isUser() || isAdmin())) return showAlert($("userAlert"), "Please login first.", "bad");
  setActiveTab($("tabInventory"));
  showPanel("inventory");
  renderInventory();
});

$("btnAdminLogin").addEventListener("click", () => {
  const email = ($("aEmail").value || "").trim();
  const pass = ($("aPass").value || "").trim();

  if(email === CONFIG.adminEmail && pass === CONFIG.adminPassword){
    setSession({ role:"admin", email, ts: Date.now() });
    showAlert($("adminAlert"), "Admin login successful.", "ok");
  }else{
    showAlert($("adminAlert"), "Invalid admin credentials.", "bad");
  }
});

$("btnAdminLogout").addEventListener("click", () => {
  clearSession();
  showAlert($("adminAlert"), "Logged out.", "ok");
});

$("btnGoInventoryFromAdmin").addEventListener("click", () => {
  if(!isAdmin()) return showAlert($("adminAlert"), "Admin login required.", "bad");
  setActiveTab($("tabInventory"));
  showPanel("inventory");
  renderInventory();
});

$("btnAddNew").addEventListener("click", addNew);

$("btnSave").addEventListener("click", () => {
  if(!isAdmin()) return;

  const id = ($("mId").value || "").trim();
  const name = ($("mName").value || "").trim();
  const pack = ($("mPack").value || "").trim();
  const mrp = Number(($("mMrp").value || "").trim());
  const price = Number(($("mPrice").value || "").trim());
  const stock = Number(($("mStock").value || "").trim());

  if(name.length < 2) return showAlert($("formAlert"), "Enter medicine name.", "bad");
  if(pack.length < 1) return showAlert($("formAlert"), "Enter pack/strength.", "bad");
  if(isNaN(mrp) || mrp < 0) return showAlert($("formAlert"), "Enter valid MRP.", "bad");
  if(isNaN(price) || price < 0) return showAlert($("formAlert"), "Enter valid Price.", "bad");
  if(isNaN(stock) || stock < 0) return showAlert($("formAlert"), "Enter valid Stock.", "bad");

  if(id){
    // update
    const idx = inventory.findIndex(x => x.id === id);
    if(idx >= 0){
      inventory[idx] = { ...inventory[idx], name, pack, mrp, price, stock };
      saveInventory(inventory);
      renderInventory();
      showAlert($("formAlert"), "Updated successfully.", "ok");
      showAlert($("invAlert"), "Inventory updated.", "ok");
    }
  }else{
    // add
    const item = { id: uid(), name, pack, mrp, price, stock };
    inventory.unshift(item);
    saveInventory(inventory);
    renderInventory();
    showAlert($("formAlert"), "Added successfully.", "ok");
    showAlert($("invAlert"), "New medicine added.", "ok");
  }
});

$("btnClear").addEventListener("click", () => clearForm());

$("btnExport").addEventListener("click", exportJSON);
$("btnImport").addEventListener("click", importJSON);

$("btnReset").addEventListener("click", () => {
  if(!isAdmin()) return;
  const ok = confirm("Reset inventory to demo data?");
  if(!ok) return;
  inventory = demoData();
  saveInventory(inventory);
  renderInventory();
  clearForm();
  showAlert($("invAlert"), "Reset done.", "ok");
});

$("searchBox").addEventListener("input", renderInventory);
$("stockFilter").addEventListener("change", renderInventory);

/* =========================
   INIT
   ========================= */
$("yr").textContent = new Date().getFullYear();
updateSessionPill();
syncRoleUI();
clearForm();
</script>
</body>
</html>
